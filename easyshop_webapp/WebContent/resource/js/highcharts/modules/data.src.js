(function(b){var c=b.each;var a=function(e,d){this.init(e,d)};b.extend(a.prototype,{init:function(d,e){this.options=d;this.chartOptions=e;this.columns=d.columns||this.rowsToColumns(d.rows)||[];if(this.columns.length){this.dataFound()}else{this.parseCSV();this.parseTable();this.parseGoogleSpreadsheet()}},getColumnDistribution:function(){var g=this.chartOptions,e=function(h){return(b.seriesTypes[h||"line"].prototype.pointArrayMap||[0]).length},f=g&&g.chart&&g.chart.type,d=[];c((g&&g.series)||[],function(h){d.push(e(h.type||f))});this.valueCount={global:e(f),individual:d}},dataFound:function(){if(this.options.switchRowsAndColumns){this.columns=this.rowsToColumns(this.columns)}this.parseTypes();this.findHeaderRow();this.parsed();this.complete()},parseCSV:function(){var l=this,n=this.options,g=n.csv,e=this.columns,k=n.startRow||0,f=n.endRow||Number.MAX_VALUE,d=n.startColumn||0,i=n.endColumn||Number.MAX_VALUE,j,m,h=0;if(g){m=g.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split(n.lineDelimiter||"\n");j=n.itemDelimiter||(g.indexOf("\t")!==-1?"\t":",");c(m,function(p,s){var t=l.trim(p),r=t.indexOf("#")===0,o=t==="",q;if(s>=k&&s<=f&&!r&&!o){q=p.split(j);c(q,function(v,u){if(u>=d&&u<=i){if(!e[u-d]){e[u-d]=[]}e[u-d][h]=v}});h+=1}});this.dataFound()}},parseTable:function(){var f=this.options,i=f.table,g=this.columns,e=f.startRow||0,d=f.endRow||Number.MAX_VALUE,h=f.startColumn||0,j=f.endColumn||Number.MAX_VALUE;if(i){if(typeof i==="string"){i=document.getElementById(i)}c(i.getElementsByTagName("tr"),function(l,k){if(k>=e&&k<=d){c(l.children,function(n,m){if((n.tagName==="TD"||n.tagName==="TH")&&m>=h&&m<=j){if(!g[m-h]){g[m-h]=[]}g[m-h][k-e]=n.innerHTML}})}});this.dataFound()}},parseGoogleSpreadsheet:function(){var l=this,m=this.options,e=m.googleSpreadsheetKey,g=this.columns,k=m.startRow||0,h=m.endRow||Number.MAX_VALUE,f=m.startColumn||0,i=m.endColumn||Number.MAX_VALUE,d,j;if(e){jQuery.ajax({dataType:"json",url:"https://spreadsheets.google.com/feeds/cells/"+e+"/"+(m.googleSpreadsheetWorksheet||"od6")+"/public/values?alt=json-in-script&callback=?",error:m.error,success:function(r){var p=r.feed.entry,n,t=p.length,s=0,o=0,q;for(q=0;q<t;q++){n=p[q];s=Math.max(s,n.gs$cell.col);o=Math.max(o,n.gs$cell.row)}for(q=0;q<s;q++){if(q>=f&&q<=i){g[q-f]=[];g[q-f].length=Math.min(o,h-k)}}for(q=0;q<t;q++){n=p[q];d=n.gs$cell.row-1;j=n.gs$cell.col-1;if(j>=f&&j<=i&&d>=k&&d<=h){g[j-f][d-k]=n.content.$t}}l.dataFound()}})}},findHeaderRow:function(){var d=0;c(this.columns,function(e){if(typeof e[0]!=="string"){d=null}});this.headerRow=0},trim:function(d){return typeof d==="string"?d.replace(/^\s+|\s+$/g,""):d},parseTypes:function(){var g=this.columns,f=g.length,j,i,d,h,e;while(f--){j=g[f].length;while(j--){i=g[f][j];d=parseFloat(i);h=this.trim(i);if(h==d){g[f][j]=d;if(d>365*24*3600*1000){g[f].isDatetime=true}else{g[f].isNumeric=true}}else{e=this.parseDate(i);if(f===0&&typeof e==="number"&&!isNaN(e)){g[f][j]=e;g[f].isDatetime=true}else{g[f][j]=h===""?null:h}}}}},dateFormats:{"YYYY-mm-dd":{regex:"^([0-9]{4})-([0-9]{2})-([0-9]{2})$",parser:function(d){return Date.UTC(+d[1],d[2]-1,+d[3])}}},parseDate:function(h){var i=this.options.parseDate,e,f,g,d;if(i){e=i(h)}if(typeof h==="string"){for(f in this.dateFormats){g=this.dateFormats[f];d=h.match(g.regex);if(d){e=g.parser(d)}}}return e},rowsToColumns:function(h){var i,f,d,g,e;if(h){e=[];f=h.length;for(i=0;i<f;i++){g=h[i].length;for(d=0;d<g;d++){if(!e[d]){e[d]=[]}e[d][i]=h[i][d]}}}return e},parsed:function(){if(this.options.parsed){this.options.parsed.call(this,this.columns)}},complete:function(){var d=this.columns,m,n,p=this.options,o,k,h,l,g,f,e;if(p.complete||p.afterComplete){this.getColumnDistribution();if(d.length>1){m=d.shift();if(this.headerRow===0){m.shift()}if(m.isDatetime){n="datetime"}else{if(!m.isNumeric){n="category"}}}for(l=0;l<d.length;l++){if(this.headerRow===0){d[l].name=d[l].shift()}}k=[];for(l=0,f=0;l<d.length;f++){o=b.pick(this.valueCount.individual[f],this.valueCount.global);h=[];if(l+o<=d.length){for(g=0;g<d[l].length;g++){h[g]=[m[g],d[l][g]!==undefined?d[l][g]:null];if(o>1){h[g].push(d[l+1][g]!==undefined?d[l+1][g]:null)}if(o>2){h[g].push(d[l+2][g]!==undefined?d[l+2][g]:null)}if(o>3){h[g].push(d[l+3][g]!==undefined?d[l+3][g]:null)}if(o>4){h[g].push(d[l+4][g]!==undefined?d[l+4][g]:null)}}}k[f]={name:d[l].name,data:h};l+=o}e={xAxis:{type:n},series:k};if(p.complete){p.complete(e)}if(p.afterComplete){p.afterComplete(e)}}}});b.Data=a;b.data=function(d,e){return new a(d,e)};b.wrap(b.Chart.prototype,"init",function(e,f,g){var d=this;if(f&&f.data){b.data(b.extend(f.data,{afterComplete:function(k){var j,h;if(f.hasOwnProperty("series")){if(typeof f.series==="object"){j=Math.max(f.series.length,k.series.length);while(j--){h=f.series[j]||{};f.series[j]=b.merge(h,k.series[j])}}else{delete f.series}}f=b.merge(k,f);e.call(d,f,g)}}),f)}else{e.call(d,f,g)}})}(Highcharts));