define("echarts/chart/k",["require","../component/base","./base","../util/shape/Candle","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","zrender/tool/util","../chart"],function(h){function d(n,l,i,p,m){c.call(this,n,l,i,p,m),k.call(this),this.refresh(p)}var c=h("../component/base"),k=h("./base"),b=h("../util/shape/Candle");h("../component/axis"),h("../component/grid"),h("../component/dataZoom");var j=h("../config"),f=h("../util/ecData"),g=h("zrender/tool/util");return d.prototype={type:j.CHART_TYPE_K,_buildShape:function(){var q=this.series;this.selectedMap={};for(var o,m={top:[],bottom:[]},r=0,l=q.length;l>r;r++){q[r].type===j.CHART_TYPE_K&&(q[r]=this.reformOption(q[r]),this.legendHoverLink=q[r].legendHoverLink||this.legendHoverLink,o=this.component.xAxis.getAxis(q[r].xAxisIndex),o.type===j.COMPONENT_TYPE_AXIS_CATEGORY&&m[o.getPosition()].push(r))}for(var p in m){m[p].length>0&&this._buildSinglePosition(p,m[p])}this.addShapeList()},_buildSinglePosition:function(r,p){var m=this._mapData(p),v=m.locationMap,l=m.maxDataLength;if(0!==l&&0!==v.length){this._buildHorizontal(p,l,v);for(var u=0,q=p.length;q>u;u++){this.buildMark(p[u])}}},_mapData:function(w){for(var y,v,q=this.series,x=this.component.legend,p=[],z=0,m=0,u=w.length;u>m;m++){y=q[w[m]],v=y.name,this.selectedMap[v]=x?x.isSelected(v):!0,this.selectedMap[v]&&p.push(w[m]),z=Math.max(z,y.data.length)}return{locationMap:p,maxDataLength:z}},_buildHorizontal:function(K,z,H){for(var E,N,D,A,B,G,I,L,F,M,C=this.series,x={},q=0,v=H.length;v>q;q++){E=H[q],N=C[E],D=N.xAxisIndex||0,A=this.component.xAxis.getAxis(D),I=N.barWidth||Math.floor(A.getGap()/2),M=N.barMaxWidth,M&&I>M&&(I=M),B=N.yAxisIndex||0,G=this.component.yAxis.getAxis(B),x[E]=[];for(var J=0,w=z;w>J&&null!=A.getNameByIndex(J);J++){L=N.data[J],F=null!=L?null!=L.value?L.value:L:"-","-"!==F&&4==F.length&&x[E].push([A.getCoordByIndex(J),I,G.getCoord(F[0]),G.getCoord(F[1]),G.getCoord(F[2]),G.getCoord(F[3]),J,A.getNameByIndex(J)])}}this._buildKLine(K,x)},_buildKLine:function(O,B){for(var J,F,S,C,D,H,K,P,G,Q,E,A,o,q,M,w,N,T=this.series,R=0,z=O.length;z>R;R++){if(N=O[R],E=T[N],q=B[N],this._isLarge(q)&&(q=this._getLargePointList(q)),E.type===j.CHART_TYPE_K&&null!=q){A=E,J=this.query(A,"itemStyle.normal.lineStyle.width"),F=this.query(A,"itemStyle.normal.lineStyle.color"),S=this.query(A,"itemStyle.normal.lineStyle.color0"),C=this.query(A,"itemStyle.normal.color"),D=this.query(A,"itemStyle.normal.color0"),H=this.query(A,"itemStyle.emphasis.lineStyle.width"),K=this.query(A,"itemStyle.emphasis.lineStyle.color"),P=this.query(A,"itemStyle.emphasis.lineStyle.color0"),G=this.query(A,"itemStyle.emphasis.color"),Q=this.query(A,"itemStyle.emphasis.color0");for(var I=0,v=q.length;v>I;I++){M=q[I],o=E.data[M[6]],A=o,w=M[3]<M[2],this.shapeList.push(this._getCandle(N,M[6],M[7],M[0],M[1],M[2],M[3],M[4],M[5],w?this.query(A,"itemStyle.normal.color")||C:this.query(A,"itemStyle.normal.color0")||D,this.query(A,"itemStyle.normal.lineStyle.width")||J,w?this.query(A,"itemStyle.normal.lineStyle.color")||F:this.query(A,"itemStyle.normal.lineStyle.color0")||S,w?this.query(A,"itemStyle.emphasis.color")||G||C:this.query(A,"itemStyle.emphasis.color0")||Q||D,this.query(A,"itemStyle.emphasis.lineStyle.width")||H||J,w?this.query(A,"itemStyle.emphasis.lineStyle.color")||K||F:this.query(A,"itemStyle.emphasis.lineStyle.color0")||P||S))}}}},_isLarge:function(a){return a[0][1]<0.5},_getLargePointList:function(p){for(var o=this.component.grid.getWidth(),m=p.length,q=[],l=0;o>l;l++){q[l]=p[Math.floor(m/o*l)]}return q},_getCandle:function(E,J,B,v,s,a,A,C,F,x,G,q,I,w,z){var D=this.series,H={zlevel:this._zlevelBase,clickable:this.deepQuery([D[E].data[J],D[E]],"clickable"),style:{x:v,y:[a,A,C,F],width:s,color:x,strokeColor:q,lineWidth:G,brushType:"both"},highlightStyle:{color:I,strokeColor:z,lineWidth:w},_seriesIndex:E};return f.pack(H,D[E],E,D[E].data[J],J,B),H=new b(H)},getMarkCoord:function(p,o){var m=this.series[p],q=this.component.xAxis.getAxis(m.xAxisIndex),l=this.component.yAxis.getAxis(m.yAxisIndex);return["string"!=typeof o.xAxis&&q.getCoordByIndex?q.getCoordByIndex(o.xAxis||0):q.getCoord(o.xAxis||0),"string"!=typeof o.yAxis&&l.getCoordByIndex?l.getCoordByIndex(o.yAxis||0):l.getCoord(o.yAxis||0)]},refresh:function(a){a&&(this.option=a,this.series=a.series),this.backupShapeList(),this._buildShape()},addDataAnimation:function(y){for(var B=this.series,w={},s=0,A=y.length;A>s;s++){w[y[s][0]]=y[s]}for(var q,p,v,x,z,u,s=0,A=this.shapeList.length;A>s;s++){if(z=this.shapeList[s]._seriesIndex,w[z]&&!w[z][3]&&"candle"===this.shapeList[s].type){if(u=f.get(this.shapeList[s],"dataIndex"),x=B[z],w[z][2]&&u===x.data.length-1){this.zr.delShape(this.shapeList[s].id);continue}if(!w[z][2]&&0===u){this.zr.delShape(this.shapeList[s].id);continue}p=this.component.xAxis.getAxis(x.xAxisIndex||0).getGap(),q=w[z][2]?p:-p,v=0,this.zr.animate(this.shapeList[s].id,"").when(500,{position:[q,v]}).start()}}}},g.inherits(d,k),g.inherits(d,c),h("../chart").define("k",d),d});