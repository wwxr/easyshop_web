define("echarts/chart/bar",["require","../component/base","./base","zrender/shape/Rectangle","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","zrender/tool/util","zrender/tool/color","../chart"],function(h){function k(p,l,i,q,n){g.call(this,p,l,i,q,n),d.call(this),this.refresh(q)}var g=h("../component/base"),d=h("./base"),j=h("zrender/shape/Rectangle");h("../component/axis"),h("../component/grid"),h("../component/dataZoom");var c=h("../config"),b=h("../util/ecData"),m=h("zrender/tool/util"),f=h("zrender/tool/color");return k.prototype={type:c.CHART_TYPE_BAR,_buildShape:function(){this._bulidPosition()},_buildNormal:function(ar,ae,an,aj,ai){for(var ag,af,al,ao,at,ak,au,ah,ad,B,D,Z,ap=this.series,aq=an[0][0],av=ap[aq],aw=av.xAxisIndex,aa=av.yAxisIndex,am="horizontal"==ai?this.component.xAxis.getAxis(aw):this.component.yAxis.getAxis(aa),J=this._mapSize(am,an),ac=J.gap,q=J.barGap,ab=J.barWidthMap,a=J.barMaxWidthMap,O=J.barWidth,N=J.barMinHeightMap,G=J.interval,F=0,Q=ae;Q>F&&null!=am.getNameByIndex(F);F++){"horizontal"==ai?ao=am.getCoordByIndex(F)-ac/2:at=am.getCoordByIndex(F)+ac/2;for(var P=0,R=an.length;R>P;P++){aa=ap[an[P][0]].yAxisIndex||0,aw=ap[an[P][0]].xAxisIndex||0,ag="horizontal"==ai?this.component.yAxis.getAxis(aa):this.component.xAxis.getAxis(aw),au=ak=ad=ah=ag.getCoord(0);for(var Y=0,H=an[P].length;H>Y;Y++){if(aq=an[P][Y],av=ap[aq],D=av.data[F],Z=null!=D?null!=D.value?D.value:D:"-",aj[aq]=aj[aq]||{min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,sum:0,counter:0,average:0},"-"!==Z){Z>0?(af=Y>0?ag.getCoordSize(Z):"horizontal"==ai?au-ag.getCoord(Z):ag.getCoord(Z)-au,1===H&&N[aq]>af&&(af=N[aq]),"horizontal"==ai?(ak-=af,at=ak):(ao=ak,ak+=af)):0>Z?(af=Y>0?ag.getCoordSize(Z):"horizontal"==ai?ag.getCoord(Z)-ad:ad-ag.getCoord(Z),1===H&&N[aq]>af&&(af=N[aq]),"horizontal"==ai?(at=ah,ah+=af):(ah-=af,ao=ah)):(af=0,"horizontal"==ai?(ak-=af,at=ak):(ao=ak,ak+=af));var al=Math.min(a[aq]||Number.MAX_VALUE,ab[aq]||O);aj[aq][F]="horizontal"==ai?ao+al/2:at-al/2,aj[aq].min>Z&&(aj[aq].min=Z,"horizontal"==ai?(aj[aq].minY=at,aj[aq].minX=aj[aq][F]):(aj[aq].minX=ao+af,aj[aq].minY=aj[aq][F])),aj[aq].max<Z&&(aj[aq].max=Z,"horizontal"==ai?(aj[aq].maxY=at,aj[aq].maxX=aj[aq][F]):(aj[aq].maxX=ao+af,aj[aq].maxY=aj[aq][F])),aj[aq].sum+=Z,aj[aq].counter++,F%G===0&&(B=this._getBarItem(aq,F,am.getNameByIndex(F),ao,at-("horizontal"==ai?0:al),"horizontal"==ai?al:af,"horizontal"==ai?af:al,"horizontal"==ai?"vertical":"horizontal"),this.shapeList.push(new j(B)))}}for(var Y=0,H=an[P].length;H>Y;Y++){aq=an[P][Y],av=ap[aq],D=av.data[F],Z=null!=D?null!=D.value?D.value:D:"-","-"==Z&&this.deepQuery([D,av,this.option],"calculable")&&("horizontal"==ai?(ak-=this.ecTheme.island.r,at=ak):(ao=ak,ak+=this.ecTheme.island.r),al=Math.min(a[aq]||Number.MAX_VALUE,ab[aq]||O),B=this._getBarItem(aq,F,am.getNameByIndex(F),ao+0.5,at+0.5-("horizontal"==ai?0:al),("horizontal"==ai?al:this.ecTheme.island.r)-1,("horizontal"==ai?this.ecTheme.island.r:al)-1,"horizontal"==ai?"vertical":"horizontal"),B.hoverable=!1,B.draggable=!1,B.style.lineWidth=1,B.style.brushType="stroke",B.style.strokeColor=av.calculableHolderColor||this.ecTheme.calculableHolderColor,this.shapeList.push(new j(B)))}"horizontal"==ai?ao+=al+q:at-=al+q}}this._calculMarkMapXY(aj,an,"horizontal"==ai?"y":"x")},_buildHorizontal:function(o,l,a,p){return this._buildNormal(o,l,a,p,"horizontal")},_buildVertical:function(o,l,a,p){return this._buildNormal(o,l,a,p,"vertical")},_buildOther:function(Z,H,R,N){for(var M=this.series,J=0,I=R.length;I>J;J++){for(var P=0,S=R[J].length;S>P;P++){var aa=R[J][P],O=M[aa],ab=O.xAxisIndex||0,K=this.component.xAxis.getAxis(ab),G=K.getCoord(0),z=O.yAxisIndex||0,A=this.component.yAxis.getAxis(z),C=A.getCoord(0);N[aa]=N[aa]||{min0:Number.POSITIVE_INFINITY,min1:Number.POSITIVE_INFINITY,max0:Number.NEGATIVE_INFINITY,max1:Number.NEGATIVE_INFINITY,sum0:0,sum1:0,counter0:0,counter1:0,average0:0,average1:0};for(var T=0,Y=O.data.length;Y>T;T++){var ac=O.data[T],ad=null!=ac?null!=ac.value?ac.value:ac:"-";if(ad instanceof Array){var D,Q,B=K.getCoord(ad[0]),F=A.getCoord(ad[1]),q=[ac,O],E=this.deepQuery(q,"barWidth")||10,a=this.deepQuery(q,"barHeight");null!=a?(D="horizontal",ad[0]>0?(E=B-G,B-=E):E=ad[0]<0?G-B:0,Q=this._getBarItem(aa,T,ad[0],B,F-a/2,E,a,D)):(D="vertical",ad[1]>0?a=C-F:ad[1]<0?(a=F-C,F-=a):a=0,Q=this._getBarItem(aa,T,ad[0],B-E/2,F,E,a,D)),this.shapeList.push(new j(Q)),B=K.getCoord(ad[0]),F=A.getCoord(ad[1]),N[aa].min0>ad[0]&&(N[aa].min0=ad[0],N[aa].minY0=F,N[aa].minX0=B),N[aa].max0<ad[0]&&(N[aa].max0=ad[0],N[aa].maxY0=F,N[aa].maxX0=B),N[aa].sum0+=ad[0],N[aa].counter0++,N[aa].min1>ad[1]&&(N[aa].min1=ad[1],N[aa].minY1=F,N[aa].minX1=B),N[aa].max1<ad[1]&&(N[aa].max1=ad[1],N[aa].maxY1=F,N[aa].maxX1=B),N[aa].sum1+=ad[1],N[aa].counter1++}}}}this._calculMarkMapXY(N,R,"xy")},_mapSize:function(B,F,z){var w,E,v=this._findSpecialBarSzie(F,z),q=v.barWidthMap,G=v.barMaxWidthMap,y=v.barMinHeightMap,A=v.sBarWidthCounter,C=v.sBarWidthTotal,x=v.barGap,D=v.barCategoryGap,u=1;if(F.length!=A){if(z){w=B.getGap(),x=0,E=Math.floor(w/F.length),0>=E&&(u=Math.floor(F.length/w),E=1)}else{if(w="string"==typeof D&&D.match(/%$/)?Math.floor(B.getGap()*(100-parseFloat(D))/100):B.getGap()-D,"string"==typeof x&&x.match(/%$/)?(x=parseFloat(x)/100,E=Math.floor((w-C)/((F.length-1)*x+F.length-A)),x=Math.floor(E*x)):(x=parseFloat(x),E=Math.floor((w-C-x*(F.length-1))/(F.length-A))),0>=E){return this._mapSize(B,F,!0)}}}else{if(w=A>1?"string"==typeof D&&D.match(/%$/)?Math.floor(B.getGap()*(100-parseFloat(D))/100):B.getGap()-D:C,E=0,x=A>1?Math.floor((w-C)/(A-1)):0,0>x){return this._mapSize(B,F,!0)}}return this._recheckBarMaxWidth(F,q,G,y,w,E,x,u)},_findSpecialBarSzie:function(L,z){for(var H,E,P,D,B=this.series,A={},G={},I={},M=0,F=0,N=0,C=L.length;C>N;N++){for(var x={barWidth:!1,barMaxWidth:!1},q=0,v=L[N].length;v>q;q++){var w=L[N][q],J=B[w];if(!z){if(x.barWidth){A[w]=H}else{if(H=this.query(J,"barWidth"),null!=H){A[w]=H,F+=H,M++,x.barWidth=!0;for(var K=0,O=q;O>K;K++){var Q=L[N][K];A[Q]=H}}}if(x.barMaxWidth){G[w]=E}else{if(E=this.query(J,"barMaxWidth"),null!=E){G[w]=E,x.barMaxWidth=!0;for(var K=0,O=q;O>K;K++){var Q=L[N][K];G[Q]=E}}}}I[w]=this.query(J,"barMinHeight"),P=null!=P?P:this.query(J,"barGap"),D=null!=D?D:this.query(J,"barCategoryGap")}}return{barWidthMap:A,barMaxWidthMap:G,barMinHeightMap:I,sBarWidth:H,sBarMaxWidth:E,sBarWidthCounter:M,sBarWidthTotal:F,barGap:P,barCategoryGap:D}},_recheckBarMaxWidth:function(y,B,w,u,A,q,p,C){for(var v=0,x=y.length;x>v;v++){var z=y[v][0];w[z]&&w[z]<q&&(A-=q-w[z])}return{barWidthMap:B,barMaxWidthMap:w,barMinHeightMap:u,gap:A,barWidth:q,barGap:p,interval:C}},_getBarItem:function(H,w,D,B,L,A,x,E){var I,C=this.series,J=C[H],z=J.data[w],v=this._sIndex2ColorMap[H],l=[z,J],q=this.deepQuery(l,"itemStyle.normal.color")||v,r=this.deepQuery(l,"itemStyle.emphasis.color"),F=this.deepMerge(l,"itemStyle.normal"),G=F.barBorderWidth,K=this.deepMerge(l,"itemStyle.emphasis");if(I={zlevel:this._zlevelBase,clickable:this.deepQuery(l,"clickable"),style:{x:B,y:L,width:A,height:x,brushType:"both",color:this.getItemStyleColor(q,H,w,z),radius:F.barBorderRadius,lineWidth:G,strokeColor:F.barBorderColor},highlightStyle:{color:this.getItemStyleColor(r,H,w,z),radius:K.barBorderRadius,lineWidth:K.barBorderWidth,strokeColor:K.barBorderColor},_orient:E},I.highlightStyle.color=I.highlightStyle.color||("string"==typeof I.style.color?f.lift(I.style.color,-0.3):I.style.color),G>0&&I.style.height>G&&I.style.width>G?(I.style.y+=G/2,I.style.height-=G,I.style.x+=G/2,I.style.width-=G):I.style.brushType="fill",I.highlightStyle.textColor=I.highlightStyle.color,I=this.addLabel(I,J,z,D,E),"insideLeft"===I.style.textPosition||"insideRight"===I.style.textPosition||"insideTop"===I.style.textPosition||"insideBottom"===I.style.textPosition){var M=5;switch(I.style.textPosition){case"insideLeft":I.style.textX=I.style.x+M,I.style.textY=I.style.y+I.style.height/2,I.style.textAlign="left",I.style.textBaseline="middle";break;case"insideRight":I.style.textX=I.style.x+I.style.width-M,I.style.textY=I.style.y+I.style.height/2,I.style.textAlign="right",I.style.textBaseline="middle";break;case"insideTop":I.style.textX=I.style.x+I.style.width/2,I.style.textY=I.style.y+M/2,I.style.textAlign="center",I.style.textBaseline="top";break;case"insideBottom":I.style.textX=I.style.x+I.style.width/2,I.style.textY=I.style.y+I.style.height-M/2,I.style.textAlign="center",I.style.textBaseline="bottom"}I.style.textPosition="specific",I.style.textColor=I.style.textColor||"#fff"}return this.deepQuery([z,J,this.option],"calculable")&&(this.setCalculable(I),I.draggable=!0),b.pack(I,C[H],H,C[H].data[w],w,D),I},getMarkCoord:function(y,B){var w,u,A=this.series[y],q=this.xMarkMap[y],p=this.component.xAxis.getAxis(A.xAxisIndex),C=this.component.yAxis.getAxis(A.yAxisIndex);if(!B.type||"max"!==B.type&&"min"!==B.type&&"average"!==B.type){if(q.isHorizontal){w="string"==typeof B.xAxis&&p.getIndexByName?p.getIndexByName(B.xAxis):B.xAxis||0;var v=q[w];v=null!=v?v:"string"!=typeof B.xAxis&&p.getCoordByIndex?p.getCoordByIndex(B.xAxis||0):p.getCoord(B.xAxis||0),u=[v,C.getCoord(B.yAxis||0)]}else{w="string"==typeof B.yAxis&&C.getIndexByName?C.getIndexByName(B.yAxis):B.yAxis||0;var x=q[w];x=null!=x?x:"string"!=typeof B.yAxis&&C.getCoordByIndex?C.getCoordByIndex(B.yAxis||0):C.getCoord(B.yAxis||0),u=[p.getCoord(B.xAxis||0),x]}}else{var z=null!=B.valueIndex?B.valueIndex:null!=q.maxX0?"1":"";u=[q[B.type+"X"+z],q[B.type+"Y"+z],q[B.type+"Line"+z],q[B.type+z]]}return u},refresh:function(a){a&&(this.option=a,this.series=a.series),this.backupShapeList(),this._buildShape()},addDataAnimation:function(x){for(var B=this.series,v={},q=0,A=x.length;A>q;q++){v[x[q][0]]=x[q]}for(var p,C,u,w,y,r,z,q=this.shapeList.length-1;q>=0;q--){if(r=b.get(this.shapeList[q],"seriesIndex"),v[r]&&!v[r][3]&&"rectangle"===this.shapeList[q].type){if(z=b.get(this.shapeList[q],"dataIndex"),y=B[r],v[r][2]&&z===y.data.length-1){this.zr.delShape(this.shapeList[q].id);continue}if(!v[r][2]&&0===z){this.zr.delShape(this.shapeList[q].id);continue}"horizontal"===this.shapeList[q]._orient?(w=this.component.yAxis.getAxis(y.yAxisIndex||0).getGap(),u=v[r][2]?-w:w,p=0):(C=this.component.xAxis.getAxis(y.xAxisIndex||0).getGap(),p=v[r][2]?C:-C,u=0),this.shapeList[q].position=[0,0],this.zr.animate(this.shapeList[q].id,"").when(500,{position:[p,u]}).start()}}}},m.inherits(k,d),m.inherits(k,g),h("../chart").define("bar",k),k});