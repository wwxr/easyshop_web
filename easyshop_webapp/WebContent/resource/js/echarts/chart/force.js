define("echarts/chart/force",["require","../component/base","./base","../data/Graph","../layout/Force","zrender/shape/Line","zrender/shape/BezierCurve","zrender/shape/Image","../util/shape/Icon","../config","../util/ecData","zrender/tool/util","zrender/config","zrender/tool/vector","../chart"],function(G){function q(h,a,l,i,m){var g=this;v.call(this,h,a,l,i,m),w.call(this),this.__nodePositionMap={},this._graph=new C(!0),this._layout=new E,this._layout.onupdate=function(){g._step()},this._steps=1,this.ondragstart=function(){D.apply(g,arguments)},this.ondragend=function(){J.apply(g,arguments)},this.ondrop=function(){},this.shapeHandler.ondragstart=function(){g.isDragstart=!0},this.onmousemove=function(){A.apply(g,arguments)},this.refresh(i)}function D(c){if(this.isDragstart&&c.target){var a=c.target;a.fixed=!0,this.isDragstart=!1,this.zr.on(j.EVENT.MOUSEMOVE,this.onmousemove)}}function A(){this._layout.temperature=0.8,this._step()}function J(d,c){if(this.isDragend&&d.target){var a=d.target;a.fixed=!1,c.dragIn=!0,c.needRefresh=!1,this.isDragend=!1,this.zr.un(j.EVENT.MOUSEMOVE,this.onmousemove)}}function z(d,c,a){var g=f.create();return g[0]=(Math.random()-0.5)*a+d,g[1]=(Math.random()-0.5)*a+c,g}var v=G("../component/base"),w=G("./base"),C=G("../data/Graph"),E=G("../layout/Force"),H=G("zrender/shape/Line"),I=G("zrender/shape/BezierCurve"),x=G("zrender/shape/Image"),B=G("../util/shape/Icon"),k=G("../config"),F=G("../util/ecData"),b=G("zrender/tool/util"),j=G("zrender/config"),f=G("zrender/tool/vector");return q.prototype={constructor:q,type:k.CHART_TYPE_FORCE,_init:function(){var h,g=this.component.legend,d=this.series;this.clear();for(var m=0,c=d.length;c>m;m++){var l=d[m];if(l.type===k.CHART_TYPE_FORCE){if(d[m]=this.reformOption(d[m]),h=d[m].name||"",this.selectedMap[h]=g?g.isSelected(h):!0,!this.selectedMap[h]){continue}this.buildMark(m),this._initSerie(l,m);break}}},_getNodeCategory:function(c,a){return c.categories&&c.categories[a.category||0]},_getNodeQueryTarget:function(d,c,a){a=a||"normal";var g=this._getNodeCategory(d,c)||{};return[c.itemStyle&&c.itemStyle[a],g&&g.itemStyle&&g.itemStyle[a],d.itemStyle[a].nodeStyle]},_getEdgeQueryTarget:function(d,c,a){return a=a||"normal",[c.itemStyle&&c.itemStyle[a],d.itemStyle[a].linkStyle]},_initSerie:function(c,a){this._temperature=1,this._graph=c.data?this._getSerieGraphFromDataMatrix(c):this._getSerieGraphFromNodeLinks(c),this._buildLinkShapes(c,a),this._buildNodeShapes(c,a),this.zr.modLayer(this.getZlevelBase(),{panable:c.roam===!0||"move"===c.roam,zoomable:c.roam===!0||"scale"===c.roam}),this._initLayout(c),this._step()},_getSerieGraphFromDataMatrix:function(N){for(var R=[],L=0,y=[],Q=0;Q<N.matrix.length;Q++){y[Q]=N.matrix[Q].slice()}for(var u=N.data||N.nodes,Q=0;Q<u.length;Q++){var S={},g=u[Q];for(var M in g){"name"===M?S.id=g.name:S[M]=g[M]}var O=this._getNodeCategory(N,g),P=O?O.name:g.name;if(this.selectedMap[P]=this.isSelected(P),this.selectedMap[P]){R.push(S),L++}else{y.splice(L,1);for(var l=0;l<y.length;l++){y[l].splice(L,1)}}}var K=C.fromMatrix(R,y,!0);return K.eachNode(function(c,a){c.layout={size:c.data.value,mass:0},c.rawIndex=a}),K.eachEdge(function(a){a.layout={weight:a.data.weight}}),K},_getSerieGraphFromNodeLinks:function(N){for(var R=new C(!0),L=N.data||N.nodes,y=0,Q=L.length;Q>y;y++){var u=L[y];if(u&&!u.ignore){var S=this._getNodeCategory(N,u),g=S?S.name:u.name;if(this.selectedMap[g]=this.isSelected(g),this.selectedMap[g]){var M=R.addNode(u.name,u);M.rawIndex=y}}}for(var y=0,Q=N.links.length;Q>y;y++){var O=N.links[y],P=O.source,l=O.target;"number"==typeof P&&(P=L[P],P&&(P=P.name)),"number"==typeof l&&(l=L[l],l&&(l=l.name));var K=R.addEdge(P,l,O);K&&(K.rawIndex=y)}return R.eachNode(function(d){var c=d.data.value;if(null==c){c=0;for(var a=0;a<d.edges.length;a++){c+=d.edges[a].data.weight||0}}d.layout={size:c,mass:0}}),R.eachEdge(function(a){a.layout={weight:null==a.data.weight?1:a.data.weight}}),R},_initLayout:function(Q){var V=this._graph,N=V.nodes.length,K=this.query(Q,"minRadius"),T=this.query(Q,"maxRadius");this._steps=Q.steps||1,this._layout.center=this.parseCenter(this.zr,Q.center),this._layout.width=this.parsePercent(Q.size,this.zr.getWidth()),this._layout.height=this.parsePercent(Q.size,this.zr.getHeight()),this._layout.large=Q.large,this._layout.scaling=Q.scaling,this._layout.ratioScaling=Q.ratioScaling,this._layout.gravity=Q.gravity,this._layout.temperature=1,this._layout.coolDown=Q.coolDown,this._layout.preventNodeEdgeOverlap=Q.preventOverlap,this._layout.preventNodeOverlap=Q.preventOverlap;for(var W=1/0,o=-1/0,M=0;N>M;M++){var O=V.nodes[M];o=Math.max(O.layout.size,o),W=Math.min(O.layout.size,W)}for(var R=o-W,M=0;N>M;M++){var O=V.nodes[M];R>0?(O.layout.size=(O.layout.size-W)*(T-K)/R+K,O.layout.mass=O.layout.size/T):(O.layout.size=(T-K)/2,O.layout.mass=0.5)}for(var M=0;N>M;M++){var O=V.nodes[M];if("undefined"!=typeof this.__nodePositionMap[O.id]){O.layout.position=f.create(),f.copy(O.layout.position,this.__nodePositionMap[O.id])}else{if("undefined"!=typeof O.data.initial){O.layout.position=f.create(),f.copy(O.layout.position,O.data.initial)}else{var S=this._layout.center,y=Math.min(this._layout.width,this._layout.height);O.layout.position=z(S[0],S[1],0.8*y)}}var L=O.shape.style,U=O.layout.size;L.width=L.width||2*U,L.height=L.height||2*U,L.x=-L.width/2,L.y=-L.height/2,f.copy(O.shape.position,O.layout.position)}N=V.edges.length,o=-1/0;for(var M=0;N>M;M++){var P=V.edges[M];P.layout.weight>o&&(o=P.layout.weight)}for(var M=0;N>M;M++){var P=V.edges[M];P.layout.weight/=o}this._layout.init(V,Q.useWorker)},_buildNodeShapes:function(d,c){var a=this._graph,g=this.query(d,"categories");a.eachNode(function(p){var n=this._getNodeCategory(d,p.data),K=[p.data,n,d],u=this._getNodeQueryTarget(d,p.data),y=this._getNodeQueryTarget(d,p.data,"emphasis"),m=new B({style:{x:0,y:0,color:this.deepQuery(u,"color"),brushType:"both",strokeColor:this.deepQuery(u,"strokeColor")||this.deepQuery(u,"borderColor"),lineWidth:this.deepQuery(u,"lineWidth")||this.deepQuery(u,"borderWidth")},highlightStyle:{color:this.deepQuery(y,"color","emphasis"),strokeColor:this.deepQuery(y,"strokeColor","emphasis")||this.deepQuery(y,"borderColor","emphasis"),lineWidth:this.deepQuery(y,"lineWidth","emphasis")||this.deepQuery(y,"borderWidth","emphasis")},clickable:d.clickable,zlevel:this.getZlevelBase()});m.style.color||(m.style.color=this.getColor(n?n.name:p.id)),m.style.iconType=this.deepQuery(K,"symbol"),m.style.width=m.style.height=2*(this.deepQuery(K,"symbolSize")||0),m.style.iconType.match("image")&&(m.style.image=m.style.iconType.replace(new RegExp("^image:\\/\\/"),""),m=new x({style:m.style,highlightStyle:m.highlightStyle,clickable:m.clickable})),this.deepQuery(K,"itemStyle.normal.label.show")&&(m.style.text=null==p.data.label?p.id:p.data.label,m.style.textPosition=this.deepQuery(K,"itemStyle.normal.label.position"),m.style.textColor=this.deepQuery(K,"itemStyle.normal.label.textStyle.color"),m.style.textFont=this.getFont(this.deepQuery(K,"itemStyle.normal.label.textStyle")||{})),this.deepQuery(K,"itemStyle.emphasis.label.show")&&(m.highlightStyle.textPosition=this.deepQuery(K,"itemStyle.emphasis.label.position"),m.highlightStyle.textColor=this.deepQuery(K,"itemStyle.emphasis.label.textStyle.color"),m.highlightStyle.textFont=this.getFont(this.deepQuery(K,"itemStyle.emphasis.label.textStyle")||{})),this.deepQuery(K,"draggable")&&(this.setCalculable(m),m.dragEnableTime=0,m.draggable=!0,m.ondragstart=this.shapeHandler.ondragstart,m.ondragover=null);var t="";if("undefined"!=typeof p.category){var n=g[p.category];t=n&&n.name||""}F.pack(m,d,c,p.data,p.rawIndex,p.data.name||"",p.category),this.shapeList.push(m),this.zr.addShape(m),p.shape=m},this)},_buildLinkShapes:function(O,S){for(var M=this._graph,m=M.edges.length,Q=0;m>Q;Q++){var g=M.edges[Q],T=g.data,c=g.node1,L=g.node2,N=this._getEdgeQueryTarget(O,g),d=this.deepQuery(N,"type");O.linkSymbol&&"none"!==O.linkSymbol&&(d="line");var R="line"===d?H:I,P=new R({style:{xStart:0,yStart:0,xEnd:0,yEnd:0,lineWidth:1},clickable:this.query(O,"clickable"),highlightStyle:{},zlevel:this.getZlevelBase()});if(b.merge(P.style,this.query(O,"itemStyle.normal.linkStyle"),!0),b.merge(P.highlightStyle,this.query(O,"itemStyle.emphasis.linkStyle"),!0),"undefined"!=typeof T.itemStyle&&(T.itemStyle.normal&&b.merge(P.style,T.itemStyle.normal,!0),T.itemStyle.emphasis&&b.merge(P.highlightStyle,T.itemStyle.emphasis,!0)),P.style.lineWidth=P.style.lineWidth||P.style.width,P.style.strokeColor=P.style.strokeColor||P.style.color,P.highlightStyle.lineWidth=P.highlightStyle.lineWidth||P.highlightStyle.width,P.highlightStyle.strokeColor=P.highlightStyle.strokeColor||P.highlightStyle.color,F.pack(P,O,S,g.data,null==g.rawIndex?Q:g.rawIndex,g.data.name||c.id+" - "+L.id,c.id,L.id),this.shapeList.push(P),this.zr.addShape(P),g.shape=P,O.linkSymbol&&"none"!==O.linkSymbol){var K=new B({style:{x:-5,y:0,width:O.linkSymbolSize[0],height:O.linkSymbolSize[1],iconType:O.linkSymbol,brushType:"fill",color:P.style.strokeColor,opacity:P.style.opacity,shadowBlur:P.style.shadowBlur,shadowColor:P.style.shadowColor,shadowOffsetX:P.style.shadowOffsetX,shadowOffsetY:P.style.shadowOffsetY},highlightStyle:{brushType:"fill"},position:[0,0],rotation:0});P._symbolShape=K,this.shapeList.push(K),this.zr.addShape(K)}}},_updateLinkShapes:function(){for(var K=f.create(),N=this._graph.edges,u=0,m=N.length;m>u;u++){var M=N[u],g=M.node1.shape,O=M.node2.shape,c=g.position,p=O.position;if(M.shape.style.xStart=c[0],M.shape.style.yStart=c[1],M.shape.style.xEnd=p[0],M.shape.style.yEnd=p[1],"bezier-curve"===M.shape.type&&(M.shape.style.cpX1=(c[0]+p[0])/2-(p[1]-c[1])/4,M.shape.style.cpY1=(c[1]+p[1])/2-(c[0]-p[0])/4),M.shape.modSelf(),M.shape._symbolShape){var y=M.shape._symbolShape;f.copy(y.position,O.position),f.sub(K,g.position,O.position),f.normalize(K,K),f.scaleAndAdd(y.position,y.position,K,O.style.width/2+2);var L=Math.atan2(K[1],K[0]);y.rotation=Math.PI/2-L,y.modSelf()}}},_syncNodePositions:function(){for(var m=this._graph,g=0;g<m.nodes.length;g++){var d=m.nodes[g],u=d.layout.position,c=d.data,p=d.shape;p.fixed||c.fixX&&c.fixY?f.copy(u,p.position):c.fixX?(u[0]=p.position[0],p.position[1]=u[1]):c.fixY?(u[1]=p.position[1],p.position[0]=u[0]):0==isNaN(c.fixX-0)&&0==isNaN(c.fixY-0)?(p.position[0]+=(u[0]-p.position[0])*c.fixX,u[0]=p.position[0],p.position[1]+=(u[1]-p.position[1])*c.fixY,u[1]=p.position[1]):0==isNaN(c.fixX-0)?(p.position[0]+=(u[0]-p.position[0])*c.fixX,u[0]=p.position[0],p.position[1]=u[1]):0==isNaN(c.fixY-0)?(p.position[1]+=(u[1]-p.position[1])*c.fixY,u[1]=p.position[1],p.position[0]=u[0]):f.copy(p.position,u);var h=c.name;if(h){var l=this.__nodePositionMap[h];l||(l=this.__nodePositionMap[h]=f.create()),f.copy(l,u)}p.modSelf()}},_step:function(){this._syncNodePositions(),this._updateLinkShapes(),this.zr.refreshNextFrame(),this._layout.temperature>0.01?this._layout.step(this._steps):this.messageCenter.dispatch(k.EVENT.FORCE_LAYOUT_END,{},{},this.myChart)},refresh:function(d){if(d&&(this.option=d,this.series=this.option.series),this.legend=this.component.legend,this.legend){this.getColor=function(g){return this.legend.getColor(g)},this.isSelected=function(g){return this.legend.isSelected(g)}}else{var c={},a=0;this.getColor=function(g){return c[g]?c[g]:(c[g]||(c[g]=this.zr.getColor(a++)),c[g])},this.isSelected=function(){return !0}}this._init()},dispose:function(){this.clear(),this.shapeList=null,this.effectList=null,this._layout.dispose(),this._layout=null,this.__nodePositionMap={}},getPosition:function(){var a=[];return this._graph.eachNode(function(c){c.layout&&a.push({name:c.data.name,position:Array.prototype.slice.call(c.layout.position)})}),a}},b.inherits(q,w),b.inherits(q,v),G("../chart").define("force",q),q}),define("echarts/data/Graph",["require","zrender/tool/util"],function(f){var d=f("zrender/tool/util"),c=function(a){this._directed=a||!1,this.nodes=[],this.edges=[],this._nodesMap={},this._edgesMap={}};c.prototype.isDirected=function(){return this._directed},c.prototype.addNode=function(h,a){if(this._nodesMap[h]){return this._nodesMap[h]}var i=new c.Node(h,a);return this.nodes.push(i),this._nodesMap[h]=i,i},c.prototype.getNodeById=function(a){return this._nodesMap[a]},c.prototype.addEdge=function(j,i,l){if("string"==typeof j&&(j=this._nodesMap[j]),"string"==typeof i&&(i=this._nodesMap[i]),j&&i){var h=j.id+"-"+i.id;if(this._edgesMap[h]){return this._edgesMap[h]}var k=new c.Edge(j,i,l);return this._directed&&(j.outEdges.push(k),i.inEdges.push(k)),j.edges.push(k),j!==i&&i.edges.push(k),this.edges.push(k),this._edgesMap[h]=k,k}},c.prototype.removeEdge=function(k){var j=k.node1,l=k.node2,h=j.id+"-"+l.id;this._directed&&(j.outEdges.splice(d.indexOf(j.outEdges,k),1),l.inEdges.splice(d.indexOf(l.inEdges,k),1)),j.edges.splice(d.indexOf(j.edges,k),1),j!==l&&l.edges.splice(d.indexOf(l.edges,k),1),delete this._edgesMap[h],this.edges.splice(d.indexOf(this.edges,k),1)},c.prototype.getEdge=function(h,a){return"string"!=typeof h&&(h=h.id),"string"!=typeof a&&(a=a.id),this._directed?this._edgesMap[h+"-"+a]||this._edgesMap[a+"-"+h]:this._edgesMap[h+"-"+a]},c.prototype.removeNode=function(h){if("string"!=typeof h||(h=this._nodesMap[h])){delete this._nodesMap[h.id],this.nodes.splice(d.indexOf(this.nodes,h),1);for(var a=0;a<this.edges.length;){var j=this.edges[a];j.node1===h||j.node2===h?this.removeEdge(j):a++}}},c.prototype.filterNode=function(j,h){for(var a=this.nodes.length,k=0;a>k;){j.call(h,this.nodes[k],k)?k++:(this.removeNode(this.nodes[k]),a--)}},c.prototype.filterEdge=function(j,h){for(var a=this.edges.length,k=0;a>k;){j.call(h,this.edges[k],k)?k++:(this.removeEdge(this.edges[k]),a--)}},c.prototype.eachNode=function(j,h){for(var a=this.nodes.length,k=0;a>k;k++){this.nodes[k]&&j.call(h,this.nodes[k],k)}},c.prototype.eachEdge=function(j,h){for(var a=this.edges.length,k=0;a>k;k++){this.edges[k]&&j.call(h,this.edges[k],k)}},c.prototype.clear=function(){this.nodes.length=0,this.edges.length=0,this._nodesMap={},this._edgesMap={}},c.prototype.breadthFirstTraverse=function(v,y,q,m){if("string"==typeof y&&(y=this._nodesMap[y]),y){var x="edges";"out"===q?x="outEdges":"in"===q&&(x="inEdges");for(var k=0;k<this.nodes.length;k++){this.nodes[k].__visited=!1}if(!v.call(m,y,null)){for(var z=[y];z.length;){for(var j=z.shift(),p=j[x],k=0;k<p.length;k++){var u=p[k],w=u.node1===j?u.node2:u.node1;if(!w.__visited){if(v.call(w,w,j)){return}z.push(w),w.__visited=!0}}}}}},c.prototype.clone=function(){for(var h=new c(this._directed),a=0;a<this.nodes.length;a++){h.addNode(this.nodes[a].id,this.nodes[a].data)}for(var a=0;a<this.edges.length;a++){var i=this.edges[a];h.addEdge(i.node1.id,i.node2.id,i.data)}return h};var g=function(h,a){this.id=h,this.data=a||null,this.inEdges=[],this.outEdges=[],this.edges=[]};g.prototype.degree=function(){return this.edges.length},g.prototype.inDegree=function(){return this.inEdges.length},g.prototype.outDegree=function(){return this.outEdges.length};var b=function(j,h,a){this.node1=j,this.node2=h,this.data=a||null};return c.Node=g,c.Edge=b,c.fromMatrix=function(x,B,q){if(B&&B.length&&B[0].length===B.length&&x.length===B.length){for(var A=B.length,k=new c(q),C=0;A>C;C++){var i=k.addNode(x[C].id,x[C]);i.data.value=0,q&&(i.data.outValue=i.data.inValue=0)}for(var C=0;A>C;C++){for(var v=0;A>v;v++){var w=B[C][v];q&&(k.nodes[C].data.outValue+=w,k.nodes[v].data.inValue+=w),k.nodes[C].data.value+=w,k.nodes[v].data.value+=w}}for(var C=0;A>C;C++){for(var v=C;A>v;v++){var w=B[C][v];if(0!==w){var y=k.nodes[C],z=k.nodes[v],j=k.addEdge(y,z,{});if(j.data.weight=w,C!==v&&q&&B[v][C]){var u=k.addEdge(z,y,{});u.data.weight=B[v][C]}}}}return k}},c}),define("echarts/layout/Force",["require","./forceLayoutWorker","zrender/tool/vector"],function(h){function k(){return Math.round((new Date).getTime()/100)%10000000}function g(){if("undefined"!=typeof Worker&&"undefined"!=typeof Blob){try{var i=new Blob([j.getWorkerCode()]);d=window.URL.createObjectURL(i)}catch(a){d=""}}return d}var d,j=h("./forceLayoutWorker"),c=h("zrender/tool/vector"),m=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){setTimeout(a,16)},b="undefined"==typeof Float32Array?Array:Float32Array,f=function(n){"undefined"==typeof d&&g(),n=n||{},this.width=n.width||500,this.height=n.height||500,this.center=n.center||[this.width/2,this.height/2],this.ratioScaling=n.ratioScaling||!1,this.scaling=n.scaling||1,this.gravity="undefined"!=typeof n.gravity?n.gravity:1,this.large=n.large||!1,this.preventNodeOverlap=n.preventNodeOverlap||!1,this.preventNodeEdgeOverlap=n.preventNodeEdgeOverlap||!1,this.maxSpeedIncrease=n.maxSpeedIncrease||1,this.onupdate=n.onupdate||function(){},this.temperature=n.temperature||1,this.coolDown=n.coolDown||0.99,this._layout=null,this._layoutWorker=null,this._token=0;var l=this,i=this._$onupdate;this._$onupdate=function(a){i.call(l,a)}};return f.prototype.updateConfig=function(){var q=this.width,p=this.height,o=Math.min(q,p),r={center:this.center,width:this.ratioScaling?q:o,height:this.ratioScaling?p:o,scaling:this.scaling||1,gravity:this.gravity||1,barnesHutOptimize:this.large,preventNodeOverlap:this.preventNodeOverlap,preventNodeEdgeOverlap:this.preventNodeEdgeOverlap,maxSpeedIncrease:this.maxSpeedIncrease};if(this._layoutWorker){this._layoutWorker.postMessage({cmd:"updateConfig",config:r})}else{for(var l in r){this._layout[l]=r[l]}}},f.prototype.init=function(x,t){if(d&&t){try{this._layoutWorker||(this._layoutWorker=new Worker(d),this._layoutWorker.onmessage=this._$onupdate),this._layout=null}catch(n){this._layoutWorker=null,this._layout||(this._layout=new j)}}else{this._layout||(this._layout=new j),this._layoutWorker&&(this._layoutWorker.terminate(),this._layoutWorker=null)}this.temperature=1,this.graph=x;for(var B=x.nodes.length,r=new b(2*B),v=new b(B),y=new b(B),z=0;B>z;z++){var a=x.nodes[z];r[2*z]=a.layout.position[0],r[2*z+1]=a.layout.position[1],v[z]="undefined"==typeof a.layout.mass?1:a.layout.mass,y[z]="undefined"==typeof a.layout.size?1:a.layout.size,a.layout.__index=z}B=x.edges.length;for(var q=new b(2*B),A=new b(B),z=0;B>z;z++){var w=x.edges[z];q[2*z]=w.node1.layout.__index,q[2*z+1]=w.node2.layout.__index,A[z]=w.layout.weight||1}this._token=k(),this._layoutWorker?this._layoutWorker.postMessage({cmd:"init",nodesPosition:r,nodesMass:v,nodesSize:y,edges:q,edgesWeight:A,token:this._token}):(this._layout.setToken(this._token),this._layout.initNodes(r,v,y),this._layout.initEdges(q,A)),this.updateConfig()},f.prototype.step=function(q){var p=this.graph.nodes;if(this._layoutWorker){for(var o=new b(2*p.length+1),r=0;r<p.length;r++){var l=p[r];o[2*r+1]=l.layout.position[0],o[2*r+2]=l.layout.position[1]}this._layoutWorker.postMessage(o.buffer,[o.buffer]),this._layoutWorker.postMessage({cmd:"update",steps:q,temperature:this.temperature,coolDown:this.coolDown});for(var r=0;q>r;r++){this.temperature*=this.coolDown}}else{m(this._$onupdate);for(var r=0;r<p.length;r++){var l=p[r];c.copy(this._layout.nodes[r].position,l.layout.position)}for(var r=0;q>r;r++){this._layout.temperature=this.temperature,this._layout.update(),this.temperature*=this.coolDown}}},f.prototype._$onupdate=function(q){if(this._layoutWorker){var p=new Float32Array(q.data),o=p[0];if(o===this._token){for(var r=0;r<this.graph.nodes.length;r++){var l=this.graph.nodes[r];l.layout.position[0]=p[2*r+1],l.layout.position[1]=p[2*r+2]}this.onupdate&&this.onupdate()}}else{if(this._layout&&this._layout.tokenMatch(this._token)){for(var r=0;r<this.graph.nodes.length;r++){var l=this.graph.nodes[r];c.copy(l.layout.position,this._layout.nodes[r].position)}this.onupdate&&this.onupdate()}}},f.prototype.dispose=function(){this._layoutWorker&&this._layoutWorker.terminate(),this._layoutWorker=null,this._layout=null,this._token=0},f}),define("zrender/shape/BezierCurve",["require","./Base","../tool/util"],function(c){var b=c("./Base"),a=function(d){this.brushTypeOnly="stroke",this.textPosition="end",b.call(this,d)};return a.prototype={type:"bezier-curve",buildPath:function(f,d){f.moveTo(d.xStart,d.yStart),"undefined"!=typeof d.cpX2&&"undefined"!=typeof d.cpY2?f.bezierCurveTo(d.cpX1,d.cpY1,d.cpX2,d.cpY2,d.xEnd,d.yEnd):f.quadraticCurveTo(d.cpX1,d.cpY1,d.xEnd,d.yEnd)},getRect:function(k){if(k.__rect){return k.__rect}var g=Math.min(k.xStart,k.xEnd,k.cpX1),f=Math.min(k.yStart,k.yEnd,k.cpY1),m=Math.max(k.xStart,k.xEnd,k.cpX1),d=Math.max(k.yStart,k.yEnd,k.cpY1),l=k.cpX2,h=k.cpY2;"undefined"!=typeof l&&"undefined"!=typeof h&&(g=Math.min(g,l),f=Math.min(f,h),m=Math.max(m,l),d=Math.max(d,h));var j=k.lineWidth||1;return k.__rect={x:g-j,y:f-j,width:m-g+j,height:d-f+j},k.__rect}},c("../tool/util").inherits(a,b),a}),define("echarts/layout/forceLayoutWorker",["require","zrender/tool/vector"],function e(m){function g(){this.subRegions=[],this.nSubRegions=0,this.node=null,this.mass=0,this.centerOfMass=null,this.bbox=new f(4),this.size=0}function d(){this.position=p.create(),this.force=p.create(),this.forcePrev=p.create(),this.speed=p.create(),this.speedPrev=p.create(),this.mass=1,this.inDegree=0,this.outDegree=0}function k(h,a){this.node1=h,this.node2=a,this.weight=1}function c(){this.barnesHutOptimize=!1,this.barnesHutTheta=1.5,this.repulsionByDegree=!1,this.preventNodeOverlap=!1,this.preventNodeEdgeOverlap=!1,this.strongGravity=!0,this.gravity=1,this.scaling=1,this.edgeWeightInfluence=1,this.center=[0,0],this.width=500,this.height=500,this.maxSpeedIncrease=1,this.nodes=[],this.edges=[],this.bbox=new f(4),this._rootRegion=new g,this._rootRegion.centerOfMass=p.create(),this._massArr=null,this._k=0}var p,b="undefined"==typeof window&&"undefined"==typeof m;p=b?{create:function(l,h){var a=new Float32Array(2);return a[0]=l||0,a[1]=h||0,a},dist:function(l,h){var a=h[0]-l[0],o=h[1]-l[1];return Math.sqrt(a*a+o*o)},len:function(l){var h=l[0],a=l[1];return Math.sqrt(h*h+a*a)},scaleAndAdd:function(l,h,a,o){return l[0]=h[0]+a[0]*o,l[1]=h[1]+a[1]*o,l},scale:function(l,h,a){return l[0]=h[0]*a,l[1]=h[1]*a,l},add:function(l,h,a){return l[0]=h[0]+a[0],l[1]=h[1]+a[1],l},sub:function(l,h,a){return l[0]=h[0]-a[0],l[1]=h[1]-a[1],l},dot:function(h,a){return h[0]*a[0]+h[1]*a[1]},normalize:function(q,o){var l=o[0],r=o[1],h=l*l+r*r;return h>0&&(h=1/Math.sqrt(h),q[0]=o[0]*h,q[1]=o[1]*h),q},negate:function(h,a){return h[0]=-a[0],h[1]=-a[1],h},copy:function(h,a){return h[0]=a[0],h[1]=a[1],h},set:function(l,h,a){return l[0]=h,l[1]=a,l}}:m("zrender/tool/vector");var f="undefined"==typeof Float32Array?Array:Float32Array;if(g.prototype.beforeUpdate=function(){for(var a=0;a<this.nSubRegions;a++){this.subRegions[a].beforeUpdate()}this.mass=0,this.centerOfMass&&(this.centerOfMass[0]=0,this.centerOfMass[1]=0),this.nSubRegions=0,this.node=null},g.prototype.afterUpdate=function(){this.subRegions.length=this.nSubRegions;for(var a=0;a<this.nSubRegions;a++){this.subRegions[a].afterUpdate()}},g.prototype.addNode=function(a){if(0===this.nSubRegions){if(null==this.node){return void (this.node=a)}this._addNodeToSubRegion(this.node),this.node=null}this._addNodeToSubRegion(a),this._updateCenterOfMass(a)},g.prototype.findSubRegion=function(l,h){for(var a=0;a<this.nSubRegions;a++){var o=this.subRegions[a];if(o.contain(l,h)){return o}}},g.prototype.contain=function(h,a){return this.bbox[0]<=h&&this.bbox[2]>=h&&this.bbox[1]<=a&&this.bbox[3]>=a},g.prototype.setBBox=function(l,h,a,o){this.bbox[0]=l,this.bbox[1]=h,this.bbox[2]=a,this.bbox[3]=o,this.size=(a-l+o-h)/2},g.prototype._newSubRegion=function(){var a=this.subRegions[this.nSubRegions];return a||(a=new g,this.subRegions[this.nSubRegions]=a),this.nSubRegions++,a},g.prototype._addNodeToSubRegion=function(x){var z=this.findSubRegion(x.position[0],x.position[1]),w=this.bbox;if(!z){var u=(w[0]+w[2])/2,y=(w[1]+w[3])/2,q=(w[2]-w[0])/2,A=(w[3]-w[1])/2,h=x.position[0]>=u?1:0,v=x.position[1]>=y?1:0,z=this._newSubRegion();z.setBBox(h*q+w[0],v*A+w[1],(h+1)*q+w[0],(v+1)*A+w[1])}z.addNode(x)},g.prototype._updateCenterOfMass=function(l){null==this.centerOfMass&&(this.centerOfMass=p.create());var h=this.centerOfMass[0]*this.mass,a=this.centerOfMass[1]*this.mass;h+=l.position[0]*l.mass,a+=l.position[1]*l.mass,this.mass+=l.mass,this.centerOfMass[0]=h/this.mass,this.centerOfMass[1]=a/this.mass},c.prototype.nodeToNodeRepulsionFactor=function(l,h,a){return a*a*l/h},c.prototype.edgeToNodeRepulsionFactor=function(l,h,a){return a*l/h},c.prototype.attractionFactor=function(l,h,a){return l*h/a},c.prototype.initNodes=function(v,n,l){this.temperature=1;var h=v.length/2;this.nodes.length=0;for(var w="undefined"!=typeof l,q=0;h>q;q++){var u=new d;u.position[0]=v[2*q],u.position[1]=v[2*q+1],u.mass=n[q],w&&(u.size=l[q]),this.nodes.push(u)}this._massArr=n,w&&(this._sizeArr=l)},c.prototype.initEdges=function(y,A){var w=y.length/2;this.edges.length=0;for(var u="undefined"!=typeof A,q=0;w>q;q++){var B=y[2*q],a=y[2*q+1],v=this.nodes[B],x=this.nodes[a];if(v&&x){v.outDegree++,x.inDegree++;var z=new k(v,x);u&&(z.weight=A[q]),this.edges.push(z)}}},c.prototype.update=function(){var q=this.nodes.length;if(this.updateBBox(),this._k=0.4*this.scaling*Math.sqrt(this.width*this.height/q),this.barnesHutOptimize){this._rootRegion.setBBox(this.bbox[0],this.bbox[1],this.bbox[2],this.bbox[3]),this._rootRegion.beforeUpdate();for(var o=0;q>o;o++){this._rootRegion.addNode(this.nodes[o])}this._rootRegion.afterUpdate()}else{var l=0,r=this._rootRegion.centerOfMass;p.set(r,0,0);for(var o=0;q>o;o++){var h=this.nodes[o];l+=h.mass,p.scaleAndAdd(r,r,h.position,h.mass)}l>0&&p.scale(r,r,1/l)}this.updateForce(),this.updatePosition()},c.prototype.updateForce=function(){for(var l=this.nodes.length,h=0;l>h;h++){var a=this.nodes[h];p.copy(a.forcePrev,a.force),p.copy(a.speedPrev,a.speed),p.set(a.force,0,0)}this.updateNodeNodeForce(),this.gravity>0&&this.updateGravityForce(),this.updateEdgeForce(),this.preventNodeEdgeOverlap&&this.updateNodeEdgeForce()},c.prototype.updatePosition=function(){for(var y=this.nodes.length,B=p.create(),w=0;y>w;w++){var u=this.nodes[w],A=u.speed;p.scale(u.force,u.force,1/30);var s=p.len(u.force)+0.1,q=Math.min(s,500)/s;p.scale(u.force,u.force,q),p.add(A,A,u.force),p.scale(A,A,this.temperature),p.sub(B,A,u.speedPrev);var v=p.len(B);if(v>0){p.scale(B,B,1/v);var x=p.len(u.speedPrev);x>0&&(v=Math.min(v/x,this.maxSpeedIncrease)*x,p.scaleAndAdd(A,u.speedPrev,B,v))}var z=p.len(A),q=Math.min(z,100)/(z+0.1);p.scale(A,A,q),p.add(u.position,u.position,A)}},c.prototype.updateNodeNodeForce=function(){for(var q=this.nodes.length,o=0;q>o;o++){var l=this.nodes[o];if(this.barnesHutOptimize){this.applyRegionToNodeRepulsion(this._rootRegion,l)}else{for(var r=o+1;q>r;r++){var h=this.nodes[r];this.applyNodeToNodeRepulsion(l,h,!1)}}}},c.prototype.updateGravityForce=function(){for(var a=0;a<this.nodes.length;a++){this.applyNodeGravity(this.nodes[a])}},c.prototype.updateEdgeForce=function(){for(var a=0;a<this.edges.length;a++){this.applyEdgeAttraction(this.edges[a])}},c.prototype.updateNodeEdgeForce=function(){for(var h=0;h<this.nodes.length;h++){for(var a=0;a<this.edges.length;a++){this.applyEdgeToNodeRepulsion(this.edges[a],this.nodes[h])}}},c.prototype.applyRegionToNodeRepulsion=function(){var a=p.create();return function(q,l){if(q.node){this.applyNodeToNodeRepulsion(q.node,l,!0)}else{if(0===q.mass&&0===l.mass){return}p.sub(a,l.position,q.centerOfMass);var s=a[0]*a[0]+a[1]*a[1];if(s>this.barnesHutTheta*q.size*q.size){var h=this._k*this._k*(l.mass+q.mass)/(s+1);p.scaleAndAdd(l.force,l.force,a,2*h)}else{for(var r=0;r<q.nSubRegions;r++){this.applyRegionToNodeRepulsion(q.subRegions[r],l)}}}}}(),c.prototype.applyNodeToNodeRepulsion=function(){var a=p.create();return function(u,s,x){if(u!==s&&(0!==u.mass||0!==s.mass)){p.sub(a,u.position,s.position);var q=a[0]*a[0]+a[1]*a[1];if(0!==q){var w,v=u.mass+s.mass,h=Math.sqrt(q);p.scale(a,a,1/h),this.preventNodeOverlap?(h=h-u.size-s.size,h>0?w=this.nodeToNodeRepulsionFactor(v,h,this._k):0>=h&&(w=this._k*this._k*10*v)):w=this.nodeToNodeRepulsionFactor(v,h,this._k),x||p.scaleAndAdd(u.force,u.force,a,2*w),p.scaleAndAdd(s.force,s.force,a,2*-w)}}}}(),c.prototype.applyEdgeAttraction=function(){var a=p.create();return function(q){var l=q.node1,v=q.node2;p.sub(a,l.position,v.position);var h,u=p.len(a);h=0===this.edgeWeightInfluence?1:1==this.edgeWeightInfluence?q.weight:Math.pow(q.weight,this.edgeWeightInfluence);var s;if(!(this.preventOverlap&&(u=u-l.size-v.size,0>=u))){var s=this.attractionFactor(h,u,this._k);p.scaleAndAdd(l.force,l.force,a,-s),p.scaleAndAdd(v.force,v.force,a,s)}}}(),c.prototype.applyNodeGravity=function(){var a=p.create();return function(l){p.sub(a,this.center,l.position),this.width>this.height?a[1]*=this.width/this.height:a[0]*=this.height/this.width;var h=p.len(a)/100;this.strongGravity?p.scaleAndAdd(l.force,l.force,a,h*this.gravity*l.mass):p.scaleAndAdd(l.force,l.force,a,this.gravity*l.mass/(h+1))}}(),c.prototype.applyEdgeToNodeRepulsion=function(){var l=p.create(),h=p.create(),a=p.create();return function(x,q){var v=x.node1,t=x.node2;if(v!==q&&t!==q){p.sub(l,t.position,v.position),p.sub(h,q.position,v.position);var i=p.len(l);p.scale(l,l,1/i);var s=p.dot(l,h);if(!(0>s||s>i)){p.scaleAndAdd(a,v.position,l,s);var u=p.dist(a,q.position)-q.size,w=this.edgeToNodeRepulsionFactor(q.mass,Math.max(u,0.1),100);p.sub(l,q.position,a),p.normalize(l,l),p.scaleAndAdd(q.force,q.force,l,w),p.scaleAndAdd(v.force,v.force,l,-w),p.scaleAndAdd(t.force,t.force,l,-w)}}}}(),c.prototype.updateBBox=function(){for(var r=1/0,q=1/0,l=-1/0,u=-1/0,h=0;h<this.nodes.length;h++){var s=this.nodes[h].position;r=Math.min(r,s[0]),q=Math.min(q,s[1]),l=Math.max(l,s[0]),u=Math.max(u,s[1])}this.bbox[0]=r,this.bbox[1]=q,this.bbox[2]=l,this.bbox[3]=u},c.getWorkerCode=function(){var a=e.toString();return a.slice(a.indexOf("{")+1,a.lastIndexOf("return"))},c.prototype.setToken=function(a){this._token=a},c.prototype.tokenMatch=function(a){return a===this._token},b){var j=null;self.onmessage=function(x){if(x.data instanceof ArrayBuffer){if(!j){return}for(var u=new Float32Array(x.data),q=(u.length-1)/2,y=0;q>y;y++){var o=j.nodes[y];o.position[0]=u[2*y+1],o.position[1]=u[2*y+2]}}else{switch(x.data.cmd){case"init":j||(j=new c),j.initNodes(x.data.nodesPosition,x.data.nodesMass,x.data.nodesSize),j.initEdges(x.data.edges,x.data.edgesWeight),j._token=x.data.token;break;case"updateConfig":if(j){for(var v in x.data.config){j[v]=x.data.config[v]}}break;case"update":var w=x.data.steps;if(j){var q=j.nodes.length,u=new Float32Array(2*q+1);j.temperature=x.data.temperature;for(var y=0;w>y;y++){j.update(),j.temperature*=x.data.coolDown}for(var y=0;q>y;y++){var o=j.nodes[y];u[2*y+1]=o.position[0],u[2*y+2]=o.position[1]}u[0]=j._token,self.postMessage(u.buffer,[u.buffer])}else{var h=new Float32Array;self.postMessage(h.buffer,[h.buffer])}}}}}return c});